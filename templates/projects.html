{% extends "base.html" %}
{% load static %}
{% load image_filters %}

{% block title %}üë®‚Äçüíª Projects {% endblock %}

{% block content %}

<main class="section projects-page">
  <div class="container">
    <h2 class="section-title">üìö All Projects </h2>
     <!-- Project Category Filters -->
    <div class="category-search">
      <h3>Filter by Category</h3>
      <div class="category-filters">
        <a href="{% url 'projects' %}" class="category-filter {% if not selected_category %}active{% endif %} all">All Projects</a>
        {% for category in project_categories %}
          <a href="{% url 'projects' %}?category={{ category.slug }}" 
             class="category-filter {% if selected_category == category.slug %}active{% endif %}">
            {{ category.name }}
          </a>
        {% endfor %}
      </div>
    </div>
    <!-- Projects Search -->
<div class="search-container">
    <input type="text" id="projectSearch" placeholder="Search Projects..." autocomplete="off">
    <button id="projectSearchBtn">Search</button>
    <ul id="projectSearchResults" class="search-results"></ul>
</div>
<div class="project-grid">
      {% for project in projects %}
        <div class="project-card">
          <picture>
            <source srcset="{{ project.image|webp }}" type="image/webp">
            <img src="{{ project.image.url }}" alt="{{ project.title }}" class="project-image" loading="lazy" decoding="async">
          </picture>
          <h3><a href="{% url 'project_details' project.slug %}" style="text-decoration: none;">
            {{ project.title }}
          </a></h3>
          <!-- Add this inside your project card, after the meta information -->
{% if project.category %}
  <div class="project-category">
    <i class="uil uil-folder"></i> {{ project.category.name }}
  </div>
{% endif %}
          <p>{{ project.description|truncatewords:30|safe }}</p>
          <div class="project-meta">
            <span><i class="uil uil-eye"></i> {{ project.views }} Views</span> 
            <span class="like-count"><i class="uil uil-heart"></i> {{ project.likes }} Likes</span> 
            <span><i class="uil uil-comment-alt-lines"></i> {{project.comments.count}} Comments</span> 

          </div>
          
          <div class="project-links">
            {% if project.repo_url %}<a href="{{ project.repo_url }}" target="_blank">View Code</a>{% endif %}
            {% if project.live_url %}<a href="{{ project.live_url }}" target="_blank">Live Site</a>{% endif %}
            <a href="{% url 'project_details' project.slug %}" class="more-info">More Info</a>
          </div>
          
        </div>
        {% empty %}
        <p>No projects available yet.</p>
      {% endfor %}

    </div>
    
    <div class="pagination">
  {% if projects.has_previous %}
    <a href="?page=1{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">&laquo; First</a>
    <a href="?page={{ projects.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">Previous</a>
  {% endif %}

  <span class="button disabled">
    Page {{ projects.number }} of {{ projects.paginator.num_pages }}
  </span>

  {% if projects.has_next %}
    <a href="?page={{ projects.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">Next</a>
    <a href="?page={{ projects.paginator.num_pages }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">Last &raquo;</a>
  {% endif %}
</div>
</main>
{% endblock %}
