{% extends "base.html" %}
{% load static %}
{% load image_filters %}

{% block title %}üë®‚Äçüíª Blog {% endblock %}

{% block content %}

<!-- üìù Blog Section -->
<section class="section blog-page" id="blog">
  <div class="container">
    <h2 class="section-title">üìù My Blog </h2>
    <!-- Blog Category Filters -->
    <div class="category-search">
      <h3>Filter by Category</h3>
      <div class="category-filters">
        <a href="{% url 'blog' %}" class="category-filter {% if not selected_category %}active{% endif %} all">All Posts</a>
        {% for category in blog_categories %}
          <a href="{% url 'blog' %}?category={{ category.slug }}" 
             class="category-filter {% if selected_category == category.slug %}active{% endif %}">
            {{ category.name }}
          </a>
        {% endfor %}
      </div>
    </div>
    <!-- Blog Search -->
<div class="search-container">
    <input type="text" id="blogSearch" placeholder="Search Blog Posts..." autocomplete="off">
    <button id="blogSearchBtn">Search</button>
    <ul id="blogSearchResults" class="search-results"></ul>
</div>


    <div class="blog-grid">
      {% for post in blog_posts %}
      <div class="blog-card">
        <picture>
            <source srcset="{{ post.image|webp }}" type="image/webp">
            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="blog-image" loading="lazy" decoding="async">
          </picture>

        
        <a href="{% url 'blog_detail' post.slug %}" class="blog-title-link" style="text-decoration: none;">
                <h3>{{ post.title }}</h3>
              </a>
              <!-- Add this inside your blog card, after the meta information -->
{% if post.category %}
  <div class="blog-category">
    <i class="uil uil-folder"></i> {{ post.category.name }}
  </div>
{% endif %}
        <p>{{ post.excerpt|truncatewords:30|safe }}</p>
        <div class="blog-meta">
          <span><i class="uil uil-calendar-alt"></i> {{ post.created_at }}</span>
          <span><i class="uil uil-user"></i> {{ post.author }}</span>
          <span class="like-count"><i class="uil uil-heart"></i> {{ post.likes }} Likes</span> 
          <span><i class="uil uil-comment-alt-lines"></i> {{ post.comments.count }} Comments</h3></span>
        </div>
        
        <a href="{% url 'blog_detail' post.slug %}" class="read-more">Read More</a>
      </div>
      {% empty %}
        <p>No blog posts available yet.</p>
      {% endfor %}
    </div>
    
    <div class="pagination">
  {% if blog_posts.has_previous %}
    <a href="?page=1{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">&laquo; First</a>
    <a href="?page={{ blog_posts.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">Previous</a>
  {% endif %}

  <span class="button disabled">
    Page {{ blog_posts.number }} of {{ blog_posts.paginator.num_pages }}
  </span>

  {% if blog_posts.has_next %}
    <a href="?page={{ blog_posts.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">Next</a>
    <a href="?page={{ blog_posts.paginator.num_pages }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="button button--outline">Last &raquo;</a>
  {% endif %}
</div>
</section>
{% endblock %}
